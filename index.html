<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Finger Chooser</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:-apple-system,system-ui,sans-serif;
}
#zone{
  height:100%;
  touch-action:none;
}

/* ======================
   DOT + AROS (ORIGINAL)
   ====================== */
.dot{
  --c:#ff3b30;
  position:fixed;
  width:130px;
  height:130px;
  border-radius:50%;
  transform:translate(-50%,-50%);
  background:var(--c);
  pointer-events:none;
}

/* ARO EXTERIOR */
.dot::before{
  content:"";
  position:absolute;
  inset:-16px;
  border-radius:50%;
  background:conic-gradient(
    from 0deg,
    var(--c) 0 60deg,
    transparent 60deg 150deg,
    var(--c) 150deg 210deg,
    transparent 210deg 360deg
  );
  -webkit-mask:radial-gradient(circle,transparent 60%,#000 61%);
  mask:radial-gradient(circle,transparent 60%,#000 61%);
  opacity:.9;
}

/* ARO INTERIOR */
.dot::after{
  content:"";
  position:absolute;
  inset:-8px;
  border-radius:50%;
  background:conic-gradient(
    from 30deg,
    transparent 0 40deg,
    var(--c) 40deg 90deg,
    transparent 90deg 200deg,
    var(--c) 200deg 250deg,
    transparent 250deg 360deg
  );
  -webkit-mask:radial-gradient(circle,transparent 68%,#000 69%);
  mask:radial-gradient(circle,transparent 68%,#000 69%);
  opacity:.6;
}

/* ANIMACIÃ“N */
.dot.running::before{
  animation:spin 0.65s linear infinite;
}
.dot.running::after{
  animation:spinReverse 0.75s linear infinite;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}
@keyframes spinReverse{
  to{ transform:rotate(-360deg); }
}

/* PERDEDOR */
.dot.lose{
  opacity:0;
  transform:translate(-50%,-50%) scale(.8);
  transition:.3s;
}

/* GANADOR */
.dot.win{
  background:#000 !important;
}
.dot.win::before,
.dot.win::after{
  opacity:1;
}
</style>
</head>

<body>
<div id="zone"></div>

<script>
(() => {
  const zone = document.getElementById("zone");
  const MAX = 5;
  const ROUND_MS = 4000;
  const COLORS = [
    "#ff3b30","#ff9500","#ffcc00",
    "#34c759","#00c7be",
    "#007aff","#5856d6",
    "#af52de","#ff2d55"
  ];

  const fingers = new Map();
  const dots = new Map();
  let state = "waiting";
  let timer = null;

  const rand = n => Math.floor(Math.random()*n);

  function ensureDot(id){
    if(dots.has(id)) return dots.get(id);
    const d = document.createElement("div");
    d.className = "dot";
    document.body.appendChild(d);
    dots.set(id,d);
    return d;
  }

  function removeDot(id){
    if(dots.has(id)){
      dots.get(id).remove();
      dots.delete(id);
    }
  }

  function startRound(){
    if(fingers.size < 2) return;
    state = "running";
    for(const [id,f] of fingers){
      const el = ensureDot(id);
      el.classList.add("running");
    }
    clearTimeout(timer);
    timer = setTimeout(endRound, ROUND_MS);
  }

  function endRound(){
    state = "end";
    const ids = [...fingers.keys()];
    const winner = ids[rand(ids.length)];

    for(const id of ids){
      const el = dots.get(id);
      if(!el) continue;
      el.classList.remove("running");
      el.classList.add(id === winner ? "win" : "lose");
    }
  }

  zone.addEventListener("touchstart", e => {
    e.preventDefault();

    for(const t of e.changedTouches){
      if(fingers.size >= MAX) break;
      const id = t.identifier;
      if(!fingers.has(id)){
        fingers.set(id,{
          x:t.clientX,
          y:t.clientY,
          color:COLORS[fingers.size % COLORS.length]
        });
      }
      const f = fingers.get(id);
      f.x = t.clientX;
      f.y = t.clientY;

      const el = ensureDot(id);
      el.style.left = f.x+"px";
      el.style.top = f.y+"px";
      el.style.setProperty("--c",f.color);
    }

    if(state === "waiting" && fingers.size >= 2){
      startRound();
    }
  },{passive:false});

  zone.addEventListener("touchmove", e => {
    e.preventDefault();
    for(const t of e.changedTouches){
      const f = fingers.get(t.identifier);
      if(!f) continue;
      f.x = t.clientX;
      f.y = t.clientY;
      const el = dots.get(t.identifier);
      if(el){
        el.style.left = f.x+"px";
        el.style.top = f.y+"px";
      }
    }
  },{passive:false});

  zone.addEventListener("touchend", e => {
    e.preventDefault();
    for(const t of e.changedTouches){
      fingers.delete(t.identifier);
      removeDot(t.identifier);
    }
  },{passive:false});

})();
</script>
</body>
</html>
